<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³ç›’ç”Ÿæˆå™¨</title>
    <style>
        /* ===== å…¨å±€æ ·å¼ï¼šå®Œå…¨ç»§æ‰¿1.htmlçš„UIåŸºå› ï¼Œä½†åŠŸèƒ½å‰¥ç¦» ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, sans-serif;
        }
        body {
            background-color: #f2f4f1;
            color: #1a1a1a;
            line-height: 1.6;
            padding: 16px;
            min-height: 100vh;
        }
        .container {
            max-width: 700px; /* ç¨å®½ï¼Œé€‚åº”åŒæ é…ç½®åŒº */
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 24px;
            padding: 16px 0;
        }
        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(90deg, #21d399, #21d399);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 8px;
        }
        .subtitle {
            color: #666;
            font-size: 14px;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        .text-input, .text-input-sm {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
            background: white;
            transition: border-color 0.3s;
        }
        .text-input:focus, .text-input-sm:focus {
            outline: none;
            border-color: #21d399;
        }
        .text-input-sm {
            padding: 8px 12px;
            font-size: 14px;
        }
        .generate-btn {
            width: 100%;
            background: #21d399;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .generate-btn:hover {
            background: #1aa87d;
        }
        .nav-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            background: white;
            padding: 8px;
            border-radius: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }
        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 10px 16px;
            border-radius: 30px;
            background: transparent;
            color: #555;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
        }
        .nav-tab.active {
            background: #21d399;
            color: white;
        }
        .config-panel {
            display: none;
        }
        .config-panel.active {
            display: block;
        }
        .icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: currentColor;
            mask-size: cover;
            -webkit-mask-size: cover;
        }
        .icon-mambo {
            mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z'/%3E%3C/svg%3E");
            -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z'/%3E%3C/svg%3E");
        }
        .theme-option {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        .theme-radio {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }
        .region-card, .sound-card {
            background: #f9fbfa;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border-left: 4px solid #21d399;
        }
        .btn-small {
            background: #e0e0e0;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            color: #333;
            transition: 0.2s;
        }
        .btn-small:hover {
            background: #ccc;
        }
        .btn-outline {
            background: transparent;
            border: 2px solid #21d399;
            color: #21d399;
            padding: 8px 16px;
            border-radius: 30px;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-outline:hover {
            background: #21d399;
            color: white;
        }
        .upload-area {
            border: 2px dashed #b2dfdb;
            padding: 12px;
            border-radius: 12px;
            background: #f0f9f8;
            position: relative;
            text-align: center;
        }
        .upload-input {
            opacity: 0;
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            cursor: pointer;
        }
        .base64-preview {
            font-size: 11px;
            color: #1aa87d;
            word-break: break-all;
            max-height: 60px;
            overflow-y: auto;
            background: white;
            padding: 6px;
            border-radius: 6px;
            margin-top: 8px;
        }
        .flex-row {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }
        .flex-row .form-group {
            flex: 1;
        }
        .action-bar {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 16px;
        }
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .hidden {
            display: none !important;
        }
        .error-msg {
            background: #fee;
            color: #c33;
            padding: 12px 16px;
            border-radius: 8px;
            border-left: 4px solid #c33;
            margin-bottom: 20px;
        }
        .hint {
            color: #666;
            font-size: 12px;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">


        <!-- é”™è¯¯/æç¤º åŒºåŸŸ -->
        <div class="error-msg hidden" id="errorMsg"></div>
        <div class="toast" id="toast"></div>

        <!-- å¯¼èˆªé€‰é¡¹å¡ â€”â€” åŒé…ç½®åŒºåŸŸå¯¼èˆª -->
        <div class="nav-tabs" id="navTabs">
            <div class="nav-tab active" data-tab="main">è¯­éŸ³ç›’ä¸»é…ç½®</div>
            <div class="nav-tab" data-tab="copyright">ç‰ˆæƒä¿¡æ¯é…ç½®</div>
        </div>

        <!-- ========== è¯­éŸ³ç›’ä¸»é…ç½®é¢æ¿ ========== -->
        <div id="panelMain" class="config-panel active">
            <div class="card">
                <!-- åŸºç¡€ä¿¡æ¯åŒº å¯¹åº”data.jsonå­—æ®µ -->
                <div class="form-group">
                    <label class="form-label">â‘  è¯­éŸ³ç›’åå­—</label>
                    <input type="text" class="text-input" id="appName" placeholder="ä¾‹å¦‚: é©¬é‡Œå¥¥è¯­éŸ³ç›’">
                </div>
                <div class="flex-row">
                    <div class="form-group">
                        <label class="form-label">â‘¡ åŒ…å </label>
                        <input type="text" class="text-input-sm" id="packageName" placeholder="com.example.voicebox">
                    </div>
                    <div class="form-group">
                        <label class="form-label">â‘¢ ç‰ˆæœ¬å</label>
                        <input type="text" class="text-input-sm" id="versionName" placeholder="1.0" value="1.0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">â‘£ ç‰ˆæœ¬å·</label>
                        <input type="number" class="text-input-sm" id="versionInt" placeholder="1" value="1">
                    </div>
                </div>

                <!-- ä¸Šä¼ å›¾æ ‡ + å¤§å›¾ base64 -->
                <div class="flex-row">
                    <div class="form-group">
                        <label class="form-label">â‘¤ APPå›¾æ ‡</label>
                        <div class="upload-area">
                            ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼  å›¾æ ‡
                            <input type="file" id="iconUpload" accept="image/*" class="upload-input">
                            <div id="iconBase64Preview" class="base64-preview">æœªä¸Šä¼ </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">â‘¥ é•¿æ–¹å½¢å¤§å›¾(åœ¨è¯­éŸ³ç›’APPä¸Šæ–¹æ˜¾ç¤º)</label>
                        <div class="upload-area">
                            ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼  å¤§å›¾
                            <input type="file" id="bigpicUpload" accept="image/*" class="upload-input">
                            <div id="bigpicBase64Preview" class="base64-preview">æœªä¸Šä¼ </div>
                        </div>
                    </div>
                </div>

                <!-- ä¸»é¢˜é€‰æ‹© + consoleæŒ‡ä»¤ -->
                <div class="form-group">
                    <label class="form-label">â‘¦ è¯­éŸ³ç›’ä¸»é¢˜</label>
                    <div class="theme-option">
                        <label class="theme-radio">
                            <input type="radio" name="theme" value="1" checked> æ¸…æ–°ç»¿
                        </label>
                        <label class="theme-radio">
                            <input type="radio" name="theme" value="2"> å¯çˆ±ç²‰
                        </label>
                    </div>
                </div>

                <!-- åŠ¨æ€åŒºåŸŸ&éŸ³æ•ˆç®¡ç† (å¯¹åº”regions) -->
                <div class="form-group">
                    <label class="form-label">â‘§ åŒºåŸŸä¸éŸ³æ•ˆé…ç½®</label>
                    <div id="regionsContainer"></div>
                    <button type="button" id="addRegionBtn" class="btn-outline" style="margin-top: 8px;">+ æ·»åŠ åŒºåŸŸ</button>
                </div>

                <!-- å¯¼å…¥/å¯¼å‡º & ç”Ÿæˆè¯­éŸ³ç›’JSON -->
                <div class="action-bar">
                    <button class="btn-small" id="exportMainJson">ğŸ“¤ å¯¼å‡ºé…ç½®</button>
                    <button class="btn-small" id="importMainJsonBtn">ğŸ“¥ å¯¼å…¥é…ç½®</button>
                    <input type="file" id="importMainFile" accept=".json,application/json" style="display: none;">
                </div>
                <button class="generate-btn" id="generateVoiceBoxBtn" style="margin-top: 12px;">
                    <span>âš¡ ç”Ÿæˆè¯­éŸ³ç›’iAppå·¥ç¨‹</span>
                </button>
                <!--
            <button class="generate-btn" id="WatchVideoBtn" style="margin-top: 12px; background: #ff6b6b;">
                    <span>ğŸ¥ è§‚çœ‹è§†é¢‘è¯¦ç»†æ•™ç¨‹</span>
                </button>
                  -->
                
            </div>
        </div>

        <!-- ========== ç‰ˆæƒä¿¡æ¯é…ç½®é¢æ¿ ========== å¯¹åº”bq.jsonç»“æ„ -->
        <div id="panelCopyright" class="config-panel">
            <div class="card">
                <div class="form-group">
                    <label class="form-label">â‘  QQå·(è½¯ä»¶ä¸Šå¯è”ç³»ä½œè€…)</label>
                    <input type="text" class="text-input" id="csqq" placeholder="ä½ çš„QQå·" >
                </div>
                <div class="form-group">
                    <label class="form-label">â‘¡ QQç¾¤å·(å¯è®©ç²‰ä¸åŠ ä½ çš„ç¾¤)</label>
                    <input type="text" class="text-input" id="groupqq" placeholder="ä½ çš„QQç¾¤çš„å·">
                </div>
               
                    <div class="form-group">
                        <label class="form-label">è·‘é©¬ç¯å…¬å‘Šå¼€å…³</label>
                        <select id="rolltxton" class="text-input-sm">
                            <option value="1">1 å¼€å¯</option>
                            <option value="2" selected>2 å…³é—­</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å¹¿å‘Šå›¾å¼€å…³(å¼€å¯å°†ä¼šè¦†ç›–è¯­éŸ³ç›’å¤§å›¾)</label>
                        <select id="adshow" class="text-input-sm">
                            <option value="1">1 å¼€å¯</option>
                            <option value="2" selected>2 å…³é—­</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">åº”ç”¨å¯¼èˆªæ å¼€å…³(é¦–é¡µ-æ›´å¤š-å…³äº)</label>
                        <select id="open" class="text-input-sm">
                            <option value="1" selected>1 å¼€å¯</option>
                            <option value="2">2 å…³é—­</option>
                        </select>
                    </div>
              
                <div class="form-group">
                    <label class="form-label">è·‘é©¬ç¯å…¬å‘Šå†…å®¹</label>
                    <input type="text" class="text-input" id="rolltxt" placeholder="è·‘é©¬ç¯æ»šåŠ¨å†…å®¹/å…¬å‘Š">
                </div>
                <div class="form-group">
                    <label class="form-label">å¹¿å‘Šå›¾</label>
                    <div class="upload-area">
                        ä¸Šä¼ å¹¿å‘Šå›¾
                        <input type="file" id="adimagesUpload" accept="image/*" class="upload-input">
                        <div id="adimagesPreview" class="base64-preview">æœªä¸Šä¼ </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">å¹¿å‘Šè·³è½¬åœ°å€</label>
                    <input type="text" class="text-input" id="adurl" placeholder="https://">
                </div>
                <div class="form-group">
                    <label class="form-label">åŸåˆ›è½¯ä»¶åˆé›†é“¾æ¥</label>
                    <input type="text" class="text-input" id="lanzouurl" placeholder="å¯é€‰">
                </div>
                <div class="form-group">
                    <label class="form-label">å›¢é˜Ÿä»‹ç» (æ¢è¡Œè¯·ä½¿ç”¨â€œå°äºå·+br+å¤§äºå·â€)</label>
                    <textarea class="text-input" id="teamintroduce" rows="3">å…³äºæˆ‘çš„å›¢é˜Ÿï¼šæˆ‘ä»¬æ˜¯ä¸€ä¸ªä¸“æ³¨äºåˆ†äº«çš„å›¢é˜Ÿ...</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">å…³æ³¨ä½œè€…åœ°å€</label>
                    <input type="text" class="text-input" id="yhq" placeholder="ä½œè€…è§†é¢‘è´¦å·ä¸»é¡µï¼Œå¯é€‰">
                </div>
                
                <div class="action-bar">
                    <button class="btn-small" id="exportCopyrightJson">ğŸ“¤ å¯¼å‡ºç‰ˆæƒé…ç½®</button>
                    <button class="btn-small" id="importCopyrightBtn">ğŸ“¥ å¯¼å…¥é…ç½®</button>
                    <input type="file" id="importCopyrightFile" accept=".json,application/json" style="display: none;">
                </div>
                <button class="generate-btn" id="saveCopyrightToVoiceBoxBtn" style="margin-top: 12px; background: #9c6b9f;">
                    <span>ğŸ’¾ ä¿å­˜è‡³è¯­éŸ³ç›’</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================================
        // è¯­éŸ³ç›’ç”Ÿæˆå™¨ Â· ä¸»é€»è¾‘ (å‰¥ç¦»1.htmlåŸæœ‰åŠŸèƒ½, å®ç°åŒé…ç½®ç”Ÿæˆ)
        // ============================================================

        // ---------- DOM å…ƒç´  ----------
        const panels = {
            main: document.getElementById('panelMain'),
            copyright: document.getElementById('panelCopyright')
        };
        const navTabs = document.querySelectorAll('.nav-tab');
        const toastEl = document.getElementById('toast');
        const errorMsg = document.getElementById('errorMsg');

        // ---------- å…¨å±€å˜é‡å­˜æ”¾Base64åŠé…ç½®æ•°æ® ----------
        let iconBase64 = '';       // å¸¦ data:image å‰ç¼€
        let bigpicBase64 = '';    // å¸¦å‰ç¼€
        let adImageBase64 = '';   // å¹¿å‘Šå›¾

        // ---------- åŒºåŸŸåŠ¨æ€æ•°æ® ----------
        let regions = [
            {
                regionName: "åŒºåŸŸ1",
                sounds: [
                    { label: "éŸ³æ•ˆ1", file: "" },   // fileå­˜çš„æ˜¯base64? å®é™…bjsonè¦æ±‚æ–‡ä»¶åï¼Œä½†ä¸ºäº†æ¼”ç¤ºå­˜å‚¨ä¸Šä¼ éŸ³é¢‘base64å ä½
                ]
            }
        ]; // é»˜è®¤ä¸€ä¸ªåŒºåŸŸ

        // ---------- åˆå§‹åŒ–æ¸²æŸ“åŒºåŸŸ ----------
        const regionsContainer = document.getElementById('regionsContainer');

        function renderRegions() {
            if (!regionsContainer) return;
            let html = '';
            regions.forEach((region, rIndex) => {
                html += `<div class="region-card" data-region-index="${rIndex}">
                    <div class="flex-row" style="align-items: center;">
                        <div class="form-group" style="flex: 1;">
                            <label>åŒºåŸŸåç§°</label>
                            <input type="text" class="text-input-sm" value="${escapeHtml(region.regionName || '')}" placeholder="åŒºåŸŸå" onchange="updateRegionName(${rIndex}, this.value)">
                        </div>
                        <button class="btn-small" style="margin-bottom: 12px;" onclick="removeRegion(${rIndex})">âŒ åˆ é™¤åŒºåŸŸ</button>
                    </div>
                    <div style="padding-left: 8px;">
                        <label>éŸ³æ•ˆåˆ—è¡¨ï¼š</label>`;
                region.sounds.forEach((sound, sIndex) => {
                    html += `<div class="sound-card" style="margin-left: 0; padding: 12px;" data-sound-index="${sIndex}">
                        <div class="flex-row">
                            <div class="form-group" style="flex:2;">
                                <label>éŸ³æ•ˆåç§°</label>
                                <input type="text" class="text-input-sm" value="${escapeHtml(sound.label || '')}" placeholder="éŸ³æ•ˆå" onchange="updateSoundLabel(${rIndex}, ${sIndex}, this.value)">
                            </div>
                            <div class="form-group" style="flex:2;">
                                <label>ä¸Šä¼ éŸ³é¢‘(MP3)</label>
                                <div class="upload-area" style="padding: 6px;">
                                    é€‰æ‹©æ–‡ä»¶
                                    <input type="file" accept="audio/*" class="upload-input" onchange="handleAudioUpload(event, ${rIndex}, ${sIndex})">
                                </div>
                                <div id="audioName_${rIndex}_${sIndex}" style="font-size: 11px; color: #1aa87d;">${sound.file ? sound.file.substring(0, 20)+'â€¦' : 'æœªä¸Šä¼ '}</div>
                            </div>
                            <button class="btn-small" onclick="removeSound(${rIndex}, ${sIndex})">ğŸ—‘ï¸</button>
                        </div>
                    </div>`;
                });
                html += `<button class="btn-small" onclick="addSound(${rIndex})" style="margin: 8px 0 0 20px;">+ æ·»åŠ éŸ³æ•ˆ</button>
                    </div>
                </div>`;
            });
            regionsContainer.innerHTML = html;
        }

        // è¾…åŠ©è½¬ä¹‰
        window.escapeHtml = function(text) {
            if (!text) return '';
            return String(text).replace(/&/g, '&amp;').replace(/</g, '<').replace(/>/g, '>').replace(/"/g, '&quot;');
        };

        // å…¨å±€å‡½æ•°ä»¥ä¾›onchangeè°ƒç”¨
        window.updateRegionName = function(rIndex, val) {
            if (regions[rIndex]) regions[rIndex].regionName = val;
        };
        window.updateSoundLabel = function(rIndex, sIndex, val) {
            if (regions[rIndex]?.sounds[sIndex]) regions[rIndex].sounds[sIndex].label = val;
        };
        window.removeRegion = function(rIndex) {
            regions.splice(rIndex, 1);
            renderRegions();
        };
        window.addSound = function(rIndex) {
            if (regions[rIndex]) {
                regions[rIndex].sounds.push({ label: "æ–°éŸ³æ•ˆ", file: "" });
                renderRegions();
            }
        };
        window.removeSound = function(rIndex, sIndex) {
            if (regions[rIndex]?.sounds) {
                regions[rIndex].sounds.splice(sIndex, 1);
                renderRegions();
            }
        };
        // éŸ³é¢‘ä¸Šä¼ å¤„ç† - è½¬ä¸ºbase64å­˜å‚¨
window.handleAudioUpload = function(e, rIndex, sIndex) {
    const file = e.target.files[0];
    if (file && regions[rIndex]?.sounds[sIndex]) {
        // æ˜¾ç¤ºä¸Šä¼ ä¸­çŠ¶æ€
        const displayEl = document.getElementById(`audioName_${rIndex}_${sIndex}`);
        if (displayEl) displayEl.innerText = 'è½¬æ¢ä¸­...';
        
        const reader = new FileReader();
        reader.onload = function(ev) {
            // è·å–base64å­—ç¬¦ä¸²ï¼ˆåŒ…å« data:audio/xxx;base64, å‰ç¼€ï¼‰
            const base64Audio = ev.target.result;
            // å­˜å‚¨å®Œæ•´base64åˆ°fileå­—æ®µ
            regions[rIndex].sounds[sIndex].file = base64Audio;
            // æ›´æ–°æ˜¾ç¤ºï¼šæ˜¾ç¤ºæ–‡ä»¶å+å·²ç¼–ç æ ‡è¯†
            if (displayEl) {
                displayEl.innerHTML = `<span style="color:#21d399;">âœ“ ${file.name}</span><br><small style="color:#666;">base64å·²ç¼–ç </small>`;
            }
            showToast(`éŸ³é¢‘ ${file.name} å·²ä¸Šä¼ `);
        };
        reader.onerror = function() {
            showError('éŸ³é¢‘è¯»å–å¤±è´¥');
            if (displayEl) displayEl.innerText = 'ä¸Šä¼ å¤±è´¥';
        };
        reader.readAsDataURL(file); // è½¬ä¸ºbase64
    }
};

        // æ·»åŠ åŒºåŸŸ
        document.getElementById('addRegionBtn')?.addEventListener('click', function() {
            regions.push({ regionName: "æ–°åŒºåŸŸ", sounds: [{ label: "éŸ³æ•ˆ", file: "" }] });
            renderRegions();
        });

        // ---------- ä¸»é¢˜é€‰æ‹©ç›‘å¬ console ----------
        const themeRadios = document.querySelectorAll('input[name="theme"]');
        themeRadios.forEach(radio => {
            radio.addEventListener('change', function(e) {
                if (e.target.value === '1') {
                    console.log("ä½ é€‰çš„æ˜¯æ¸…æ–°ç»¿");
                    iapp.s('sss.apptheme', "1");
                    //iapp.fn('scq.jieya()');
                } else if (e.target.value === '2') {
                    console.log("ä½ é€‰çš„æ˜¯å¯çˆ±ç²‰");
                    iapp.s('sss.apptheme', "2");
                    //iapp.fn('scq.jieya()');
                }
            });
        });

        // ---------- å›¾ç‰‡ä¸Šä¼ è½¬base64 ----------
        function handleImageUpload(file, callback) {
            const reader = new FileReader();
            reader.onload = function(e) {
                callback(e.target.result); // åŒ…å« data:image å‰ç¼€
            };
            reader.readAsDataURL(file);
        }

        // å›¾æ ‡ä¸Šä¼ 
        document.getElementById('iconUpload').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                handleImageUpload(e.target.files[0], (base64) => {
                    iconBase64 = base64;
                    document.getElementById('iconBase64Preview').innerText = base64.substring(0, 60) + 'â€¦ [å·²ç¼–ç ]';
                });
            }
        });
        document.getElementById('bigpicUpload').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                handleImageUpload(e.target.files[0], (base64) => {
                    bigpicBase64 = base64;
                    document.getElementById('bigpicBase64Preview').innerText = base64.substring(0, 60) + 'â€¦ [å·²ç¼–ç ]';
                });
            }
        });
        // å¹¿å‘Šå›¾
        document.getElementById('adimagesUpload').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                handleImageUpload(e.target.files[0], (base64) => {
                    adImageBase64 = base64;
                    document.getElementById('adimagesPreview').innerText = base64.substring(0, 60) + 'â€¦ [å·²ç¼–ç ]';
                });
            }
        });

        // ---------- å¯¼èˆªåˆ‡æ¢ ----------
        navTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                navTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                const target = this.dataset.tab;
                panels.main.classList.remove('active');
                panels.copyright.classList.remove('active');
                if (target === 'main') panels.main.classList.add('active');
                else panels.copyright.classList.add('active');
            });
        });

        // ---------- å¯¼å‡º/å¯¼å…¥ è¯­éŸ³ç›’ä¸»é…ç½® ----------
        function gatherMainJson() {
            const themeSelected = document.querySelector('input[name="theme"]:checked')?.value || '1';
            return {
                name: document.getElementById('appName').value,
                versionname: document.getElementById('versionName').value,
                versionint: parseInt(document.getElementById('versionInt').value) || 1,
                icon: iconBase64 || "data:image/png;base64,", 
                bigpic: bigpicBase64 || "data:image/png;base64,",
                package: document.getElementById('packageName').value,
                theme: themeSelected,
                regions: regions.map(r => ({
                    regionName: r.regionName,
                    sounds: r.sounds.map(s => ({ label: s.label, file: s.file || "" }))
                }))
            };
        }

        document.getElementById('exportMainJson').addEventListener('click', function() {
            
            
            const json = gatherMainJson();
            
            downloadJSON(json, 'è¯­éŸ³ç›’ä¸»é…ç½®.json');
            //showToast('âœ… å·²å¯¼å‡ºè¯­éŸ³ç›’ä¸»é…ç½®');
        });

        document.getElementById('importMainJsonBtn').addEventListener('click', function() {
            document.getElementById('importMainFile').click();
        });
        document.getElementById('importMainFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(ev) {
                    try {
                        const imported = JSON.parse(ev.target.result);
                        // å¡«å……åŸºç¡€å­—æ®µ
                        document.getElementById('appName').value = imported.name || '';
                        document.getElementById('versionName').value = imported.versionname || '';
                        document.getElementById('versionInt').value = imported.versionint || 1;
                        document.getElementById('packageName').value = imported.package || '';
                        if (imported.theme) {
                            const val = String(imported.theme);
                            document.querySelector(`input[name="theme"][value="${val}"]`).checked = true;
                        }
                        // base64é¢„è§ˆè®¾æ ‡è®°
                        if (imported.icon) { iconBase64 = imported.icon; document.getElementById('iconBase64Preview').innerText = 'å·²å¯¼å…¥ base64 å›¾æ ‡'; }
                        if (imported.bigpic) { bigpicBase64 = imported.bigpic; document.getElementById('bigpicBase64Preview').innerText = 'å·²å¯¼å…¥ base64 å¤§å›¾'; }
                        if (imported.regions) { regions = imported.regions; renderRegions(); }
                        showToast('âœ… å¯¼å…¥ä¸»é…ç½®æˆåŠŸ');
                    } catch (e) { showError('JSON è§£æå¤±è´¥'); }
                };
                reader.readAsText(file);
            }
        });

        // ---------- ç”Ÿæˆè¯­éŸ³ç›’ è®¾ç½®yyhjson ---------- 
        window.yyhjson = null;  // ä¾›å¤–éƒ¨ä½¿ç”¨
        document.getElementById('generateVoiceBoxBtn').addEventListener('click', function() {
       
            window.yyhjson = gatherMainJson();
            console.log('âœ… yyhjson å·²è®¾ç½®', window.yyhjson);
            iapp.s('sss.yyhjson', JSON.stringify(window.yyhjson, null, 2));
            window.bqmjson = gatherCopyrightJson();
            iapp.s('sss.bqmjson', JSON.stringify(window.bqmjson, null, 2));
            iapp.fn('scq.sc()');
            //showToast('âœ… å·²è®¾ç½®å˜é‡ yyhjson (è¯­éŸ³ç›’ä¸»é…ç½®)');
        });
        
        //document.getElementById('WatchVideoBtn').addEventListener('click', function() {
       
        //    iapp.fn('js.nzllq("https://www.baidu.com/")');
            //showToast('âœ… å·²è®¾ç½®å˜é‡ yyhjson (è¯­éŸ³ç›’ä¸»é…ç½®)');
       // });


        // ---------- ç‰ˆæƒä¿¡æ¯é…ç½® æ”¶é›† & å¯¼å…¥å¯¼å‡º ----------
        function gatherCopyrightJson() {
            return {
                code: 1,
                msg: "è·å–ç‰ˆæƒä¿¡æ¯æˆåŠŸ",
                data: {
                    dataInfo: {
                        csqq: document.getElementById('csqq').value,
                        groupqq: document.getElementById('groupqq').value,
                        rolltxton: document.getElementById('rolltxton').value,
                        rolltxt: document.getElementById('rolltxt').value,
                        adimages: adImageBase64 || "",
                        adurl: document.getElementById('adurl').value,
                        adshow: document.getElementById('adshow').value,
                        lanzouurl: document.getElementById('lanzouurl').value,
                        teamintroduce: document.getElementById('teamintroduce').value,
                        open: parseInt(document.getElementById('open').value),
                        yhq: document.getElementById('yhq').value,
                        ads: []
                    }
                },
                token: 123
            };
        }

        document.getElementById('exportCopyrightJson').addEventListener('click', function() {
            const json = gatherCopyrightJson();
            downloadJSON(json, 'ç‰ˆæƒä¿¡æ¯é…ç½®.json');
            //showToast('âœ… å·²å¯¼å‡ºç‰ˆæƒé…ç½®');
        });

        document.getElementById('importCopyrightBtn').addEventListener('click', function() {
            document.getElementById('importCopyrightFile').click();
        });
        document.getElementById('importCopyrightFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(ev) {
                    try {
                        const imp = JSON.parse(ev.target.result);
                        const d = imp.data?.dataInfo || imp; // å…¼å®¹
                        document.getElementById('csqq').value = d.csqq || '';
                        document.getElementById('groupqq').value = d.groupqq || '';
                        document.getElementById('rolltxton').value = d.rolltxton || '2';
                        document.getElementById('rolltxt').value = d.rolltxt || '';
                        if (d.adimages) { adImageBase64 = d.adimages; document.getElementById('adimagesPreview').innerText = 'å·²å¯¼å…¥å¹¿å‘Šå›¾'; }
                        document.getElementById('adurl').value = d.adurl || '';
                        document.getElementById('adshow').value = d.adshow || '2';
                        document.getElementById('lanzouurl').value = d.lanzouurl || '';
                        document.getElementById('teamintroduce').value = d.teamintroduce || 'å…³äºæˆ‘çš„å›¢é˜Ÿï¼šæˆ‘ä»¬æ˜¯ä¸€ä¸ªä¸“æ³¨äºåˆ†äº«çš„å›¢é˜Ÿ...';
                        document.getElementById('open').value = d.open || '1';
                        document.getElementById('yhq').value = d.yhq || '';
                        showToast('âœ… å¯¼å…¥ç‰ˆæƒé…ç½®æˆåŠŸ');
                    } catch(e) { showError('JSONè§£æå¤±è´¥'); }
                };
                reader.readAsText(file);
            }
        });

        // ---------- ä¿å­˜è‡³è¯­éŸ³ç›’ æŒ‰é’®ï¼šè®¾ç½® bqmjson ----------
        window.bqmjson = null;
        document.getElementById('saveCopyrightToVoiceBoxBtn').addEventListener('click', function() {
            window.bqmjson = gatherCopyrightJson();
            console.log('âœ… bqmjson å·²è®¾ç½®', window.bqmjson);
            iapp.s('sss.bqmjson', JSON.stringify(window.bqmjson, null, 2));
            showToast('âœ… ç‰ˆæƒé…ç½®å·²ä¿å­˜è‡³è¯­éŸ³ç›’');
        });

        // ---------- é€šç”¨å·¥å…· ----------
        function downloadJSON(obj, filename) {
            const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            iapp.s('sss.jsonobj', JSON.stringify(obj, null, 2));
            iapp.s('sss.filename', filename);
            iapp.fn('scq.xiazai()');
            
            
        }

        function showToast(msg) {
            iapp.fn('js.showToast("'+msg+'")');
        }
        function showError(msg) {
            errorMsg.textContent = msg;
            errorMsg.classList.remove('hidden');
            setTimeout(() => errorMsg.classList.add('hidden'), 3000);
        }

        // ---------- åˆå§‹æ¸²æŸ“ ----------
        renderRegions();

        // ä¸»é¢˜é»˜è®¤console (æ¸…æ–°ç»¿)
        console.log("ä½ é€‰çš„æ˜¯æ¸…æ–°ç»¿");
        iapp.s('sss.apptheme', "1");
        //iapp.fn('scq.jieya()');

        // åˆå§‹åŒ–ç‰ˆæƒæ–‡æœ¬åŸŸé»˜è®¤å€¼ (ä»introduce.txtæ„ŸçŸ¥)
        const defaultIntroduce = `å…³äºæˆ‘çš„å›¢é˜Ÿ<br><br>æˆ‘ä»¬æ˜¯ä¸€ä¸ªä¸“æ³¨äºåˆ†äº«çš„å›¢é˜Ÿ,æˆ‘ä»¬çš„ä»»åŠ¡å°±æ˜¯æ¯å¤©ç»™å¹¿å¤§ç¾¤å‹åˆ†äº«èµ„æº<br><br>æˆ‘ä»¬ä¼šæ¯å¤©ç»™å¤§å®¶åˆ†äº«ï¼šçº¿æŠ¥ã€ç¦åˆ©æ´»åŠ¨ã€è´­ç‰©ä¼˜æƒ ã€åŸåˆ›æŠ€æœ¯ã€å„ç§å¥½ç©çš„è½¯ä»¶æˆ–ç¨‹åº<br><br>æ‰€æœ‰èµ„æºå‡æ¥è‡ªäºç½‘ç»œ,å¦‚æœæœ‰ä¾µæƒè¯·è”ç³»æˆ‘`;
        document.getElementById('teamintroduce').value = defaultIntroduce;
    </script>
</body>
</html>

